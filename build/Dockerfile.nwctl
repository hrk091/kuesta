FROM golang:1.18 as builder

WORKDIR /workspace
COPY go.mod ./
COPY go.sum ./
RUN go mod download

COPY . .

ARG CGO_ENABLED=0
ARG GOOS=linux
ARG GOARCH=amd64

RUN CGO_ENABLED=${CGO_ENABLED} \
    GOOS=${GOOS} \
    GOARCH=${GOARCH} \
    go build -o nwctl -ldflags "-w -s" main.go


FROM scratch
WORKDIR /bin
COPY --from=builder /workspace/nwctl .

EXPOSE 9339

ENTRYPOINT ["/bin/nwctl"]
